<!DOCTYPE html>
<html>
<head>
    <title>Générateur TP Minecraft Tinel25</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .layout {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }

        form {
            flex: 1;
            max-width: 400px;
        }

        .visuals {
            display: flex;
            gap: 20px;
        }

        canvas {
            border: 1px solid #000;
            width: 500px;
            height: 500px;
            margin-top: 20px;
        }

        h1 {
            margin-bottom: 20px;
        }

        h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <h1>Générateur de commandes TP Minecraft Tinel25 5.0</h1>
    <div class="layout">
        <form method="post">
            <label>Liste des points (x,y,z) séparés par des retours à la ligne :</label><br>
            <textarea name="points" rows="6" cols="40">0,0,0\n10,5,3\n20,8,6</textarea><br><br>

            <label>Décalages personnalisés (x,y,z) entre chaque paire de points :</label><br>
            <textarea name="offsets" rows="5" cols="40">0,0,0\n2,1,0</textarea><br><br>

            <label>Tag Minecraft:</label><br>
            <input name="tag" value="astsuiveur"><br><br>

            <label>Vitesse (blocs/sec):</label><br>
            <input name="speed" value="4.317"><br><br>

            <label>Tick interval:</label><br>
            <input name="tick_interval" value="2"><br><br>

            <label>Delay personnalisé (en ticks):</label><br>
            <input name="delay_ticks" value="2.8"><br><br>

            <button type="submit">Générer</button>
        </form>

        <div class="visuals">
            <div>
                <h2>Visualisation 2D (X-Z)</h2>
                <canvas id="bezierCanvas" width="500" height="500"></canvas>
            </div>
        </div>
    </div>

    <script>
        function parseCoordsList(input) {
            return input.split('\n').map(line => line.trim().split(',').map(Number));
        }

        function getBezierPoints(p0, p1, p2, steps = 100) {
            const points = [];
            for (let t = 0; t <= 1; t += 1 / steps) {
                const x = (1 - t)**2 * p0.x + 2 * (1 - t) * t * p1.x + t**2 * p2.x;
                const y = (1 - t)**2 * p0.y + 2 * (1 - t) * t * p1.y + t**2 * p2.y;
                points.push({ x: x + 250, y: 500 - (y + 250) });
            }
            return points;
        }

        let animationPoints = [];
        let animationIndex = 0;

        function drawCurve2D() {
            const canvas = document.getElementById('bezierCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const points = parseCoordsList(document.querySelector('textarea[name="points"]').value);
            const offsets = parseCoordsList(document.querySelector('textarea[name="offsets"]').value);

            animationPoints = [];

            for (let i = 0; i < points.length - 1; i++) {
                const start = points[i];
                const end = points[i + 1];
                const offset = offsets[i] || [0, 0, 0];

                const control = [
                    (start[0] + end[0]) / 2 + offset[0],
                    (start[1] + end[1]) / 2 + offset[1],
                    (start[2] + end[2]) / 2 + offset[2]
                ];

                const p0 = { x: start[0], y: start[2] };
                const p1 = { x: control[0], y: control[2] };
                const p2 = { x: end[0], y: end[2] };

                const bezierPoints = getBezierPoints(p0, p1, p2);
                animationPoints.push(...bezierPoints);

                ctx.beginPath();
                bezierPoints.forEach((pt, idx) => {
                    if (idx === 0) ctx.moveTo(pt.x, pt.y);
                    else ctx.lineTo(pt.x, pt.y);
                });

                ctx.strokeStyle = "#0077cc";
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        function animateDot() {
            const canvas = document.getElementById('bezierCanvas');
            const ctx = canvas.getContext('2d');

            drawCurve2D(); // redraw curve

            if (animationPoints.length > 0) {
                const pt = animationPoints[animationIndex % animationPoints.length];
                ctx.beginPath();
                ctx.arc(pt.x, pt.y, 6, 0, 2 * Math.PI);
                ctx.fillStyle = "red";
                ctx.fill();
                animationIndex++;
            }

            requestAnimationFrame(animateDot);
        }

        document.querySelectorAll('input, textarea').forEach(el => {
            el.addEventListener('input', () => {
                animationIndex = 0;
                drawCurve2D();
            });
        });

        window.onload = () => {
            drawCurve2D();
            animateDot();
        };
    </script>
</body>
</html>
