<!DOCTYPE html>
<html>
<head>
    <title>Générateur TP Minecraft</title>
    <style>
        canvas {
            border: 1px solid #000;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Générateur de commandes TP Minecraft</h1>
    <form method="post">
        <label>Départ (x,y,z):</label><br>
        <input name="start" value="3194,77.00,400"><br><br>

        <label>Arrivée (x,y,z):</label><br>
        <input name="end" value="3183.30,77.00,377.14"><br><br>

        <label>Point de contrôle (x,y,z) <em>(laisser vide pour auto)</em>:</label><br>
        <input name="control" placeholder="auto"><br><br>

        <label>Décalage X du point de contrôle:</label><br>
        <input name="offset_x" value="0"><br><br>

        <label>Décalage Y du point de contrôle:</label><br>
        <input name="offset_y" value="0"><br><br>

        <label>Décalage Z du point de contrôle:</label><br>
        <input name="offset_z" value="6"><br><br>

        <label>UUID:</label><br>
        <input name="uuid" value="b968c6c4-03fb-4e6b-ac51-3afb62ac3de3"><br><br>

        <label>Vitesse (blocs/sec):</label><br>
        <input name="speed" value="4.317"><br><br>

        <label>Tick interval:</label><br>
        <input name="tick_interval" value="2"><br><br>

        <button type="submit">Générer</button>
    </form>

    <h2>Visualisation de la courbe (projection X-Z)</h2>
    <canvas id="bezierCanvas" width="500" height="500"></canvas>

    <script>
        function parseCoords(input) {
            return input.split(',').map(Number);
        }

        function drawCurve() {
            const canvas = document.getElementById('bezierCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const start = parseCoords(document.querySelector('input[name="start"]').value);
            const end = parseCoords(document.querySelector('input[name="end"]').value);
            const controlInput = document.querySelector('input[name="control"]').value.trim();

            const offsetX = parseFloat(document.querySelector('input[name="offset_x"]').value) || 0;
            const offsetY = parseFloat(document.querySelector('input[name="offset_y"]').value) || 0;
            const offsetZ = parseFloat(document.querySelector('input[name="offset_z"]').value) || 0;

            let control;
            if (controlInput) {
                control = parseCoords(controlInput);
            } else {
                control = [
                    (start[0] + end[0]) / 2 + offsetX,
                    (start[1] + end[1]) / 2 + offsetY,
                    (start[2] + end[2]) / 2 + offsetZ
                ];
            }

            // Projection X-Z
            const p0 = { x: start[0], y: start[2] };
            const p1 = { x: control[0], y: control[2] };
            const p2 = { x: end[0], y: end[2] };

            // Normalisation pour canvas
            const minX = Math.min(p0.x, p1.x, p2.x);
            const minY = Math.min(p0.y, p1.y, p2.y);
            const maxX = Math.max(p0.x, p1.x, p2.x);
            const maxY = Math.max(p0.y, p1.y, p2.y);

            const padding = 40;
            const scaleX = (canvas.width - padding * 2) / (maxX - minX || 1);
            const scaleY = (canvas.height - padding * 2) / (maxY - minY || 1);

            ctx.beginPath();
            for (let t = 0; t <= 1; t += 0.01) {
                const x = (1 - t)**2 * p0.x + 2 * (1 - t) * t * p1.x + t**2 * p2.x;
                const y = (1 - t)**2 * p0.y + 2 * (1 - t) * t * p1.y + t**2 * p2.y;

                const canvasX = (x - minX) * scaleX + padding;
                const canvasY = canvas.height - ((y - minY) * scaleY + padding);

                if (t === 0) {
                    ctx.moveTo(canvasX, canvasY);
                } else {
                    ctx.lineTo(canvasX, canvasY);
                }
            }

            ctx.strokeStyle = "#0077cc";
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // Mise à jour automatique
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', drawCurve);
        });

        // Dessin initial
        window.onload = drawCurve;
    </script>
</body>
</html>
